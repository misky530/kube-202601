# WordPress on Kubernetes - é¡¹ç›®çŠ¶æ€

## å½“å‰é˜¶æ®µï¼šå‡†å¤‡å¼€å§‹æµ‹è¯• âœ…

**åˆ›å»ºæ—¶é—´**: 2026-01-10  
**é¡¹ç›®ç±»å‹**: å­¦ä¹ é¡¹ç›® - Infrastructure as Code (IaC)

---

## å·²å®Œæˆçš„å·¥ä½œ

### âœ… IaC é¡¹ç›®ç»“æ„
```
wordpress-k8s/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ PROJECT-STATUS.md            # æœ¬æ–‡ä»¶ - é¡¹ç›®çŠ¶æ€
â”œâ”€â”€ .gitignore                   # Git å¿½ç•¥é…ç½®
â”œâ”€â”€ manifests/                   # Kubernetes é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ namespace.yaml           # å‘½åç©ºé—´
â”‚   â”œâ”€â”€ mysql/                   # MySQL ç›¸å…³é…ç½®
â”‚   â”‚   â”œâ”€â”€ secret.yaml          # æ•°æ®åº“å¯†ç 
â”‚   â”‚   â”œâ”€â”€ pvc.yaml             # æŒä¹…åŒ–å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ deployment.yaml      # éƒ¨ç½²é…ç½®
â”‚   â”‚   â””â”€â”€ service.yaml         # æœåŠ¡é…ç½®
â”‚   â””â”€â”€ wordpress/               # WordPress ç›¸å…³é…ç½®
â”‚       â”œâ”€â”€ pvc.yaml             # æŒä¹…åŒ–å­˜å‚¨
â”‚       â”œâ”€â”€ deployment.yaml      # éƒ¨ç½²é…ç½®ï¼ˆ3å‰¯æœ¬+å¥åº·æ£€æŸ¥ï¼‰
â”‚       â”œâ”€â”€ service.yaml         # æœåŠ¡é…ç½®ï¼ˆSession Affinityï¼‰
â”‚       â””â”€â”€ ingress.yaml         # Ingress è·¯ç”±
â”œâ”€â”€ scripts/                     # è‡ªåŠ¨åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ deploy-all.sh            # âœ… ä¸€é”®éƒ¨ç½²æ‰€æœ‰èµ„æº
â”‚   â”œâ”€â”€ delete-all.sh            # âœ… æ¸…ç†æ‰€æœ‰èµ„æº
â”‚   â”œâ”€â”€ verify.sh                # âœ… éªŒè¯é›†ç¾¤å’Œåº”ç”¨çŠ¶æ€
â”‚   â”œâ”€â”€ backup-etcd.sh           # âœ… etcd å¤‡ä»½
â”‚   â””â”€â”€ restore-etcd.sh          # âœ… etcd æ¢å¤
â”œâ”€â”€ backups/                     # å¤‡ä»½å­˜å‚¨ç›®å½•
â””â”€â”€ docs/                        # æ–‡æ¡£
    â”œâ”€â”€ quick-reference.md       # âœ… å¿«é€Ÿå‚è€ƒæ‰‹å†Œ
    â””â”€â”€ test-plan.md             # âœ… è¯¦ç»†æµ‹è¯•è®¡åˆ’
```

### âœ… Kubernetes Manifests ç‰¹æ€§

**MySQL é…ç½®**:
- [x] Secret ç®¡ç†æ•æ„Ÿæ•°æ®
- [x] PVC 5Gi æŒä¹…åŒ–å­˜å‚¨
- [x] Liveness/Readiness Probes
- [x] èµ„æºé™åˆ¶ï¼ˆ500m CPU, 1Gi Memoryï¼‰
- [x] å•å‰¯æœ¬ Recreate ç­–ç•¥

**WordPress é…ç½®**:
- [x] 3 å‰¯æœ¬éƒ¨ç½²
- [x] PVC 10Gi æŒä¹…åŒ–å­˜å‚¨
- [x] Liveness/Readiness Probes
- [x] èµ„æºé™åˆ¶ï¼ˆ500m CPU, 512Mi Memoryï¼‰
- [x] RollingUpdate ç­–ç•¥
- [x] Service Session Affinity (ClientIP)
- [x] Ingress é…ç½®ï¼ˆæ”¯æŒ Cookie Session Affinityï¼‰

### âœ… è‡ªåŠ¨åŒ–è„šæœ¬

- [x] **deploy-all.sh**: ä¸€é”®éƒ¨ç½²ï¼ŒåŒ…å«è¿›åº¦æ˜¾ç¤ºå’Œé”™è¯¯å¤„ç†
- [x] **delete-all.sh**: å®‰å…¨æ¸…ç†ï¼ˆé»˜è®¤ä¿ç•™ PVC æ•°æ®ï¼‰
- [x] **verify.sh**: å…¨é¢çš„å¥åº·æ£€æŸ¥å’ŒçŠ¶æ€éªŒè¯
- [x] **backup-etcd.sh**: etcd å¤‡ä»½ï¼Œè‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½
- [x] **restore-etcd.sh**: etcd æ¢å¤ï¼Œå¸¦å®‰å…¨ç¡®è®¤

### âœ… æ–‡æ¡£

- [x] **README.md**: é¡¹ç›®æ¦‚è§ˆå’Œå¿«é€Ÿå¼€å§‹
- [x] **quick-reference.md**: å¸¸ç”¨å‘½ä»¤å’Œæ•…éšœæ’æŸ¥
- [x] **test-plan.md**: 11 ä¸ªé˜¶æ®µçš„è¯¦ç»†æµ‹è¯•è®¡åˆ’

---

## ä¸‹ä¸€æ­¥ï¼šå¼€å§‹æµ‹è¯•

### ç«‹å³å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼š

**é€‰é¡¹ 1: éªŒè¯é›†ç¾¤çŠ¶æ€ï¼ˆæ¨èç¬¬ä¸€æ­¥ï¼‰**
```bash
cd /home/intel41/code/kube-202601/wordpress-k8s
./scripts/verify.sh
```

**é€‰é¡¹ 2: å¼€å§‹éƒ¨ç½²æµ‹è¯•**
```bash
cd /home/intel41/code/kube-202601/wordpress-k8s
./scripts/deploy-all.sh
```

**é€‰é¡¹ 3: å…ˆå¤‡ä»½ etcdï¼ˆå®‰å…¨èµ·è§ï¼‰**
```bash
cd /home/intel41/code/kube-202601/wordpress-k8s
./scripts/backup-etcd.sh
```

---

## æµ‹è¯•é˜¶æ®µæ¦‚è§ˆ

æŒ‰ç…§ [docs/test-plan.md](docs/test-plan.md) æ‰§è¡Œï¼š

1. â³ **åŸºç¡€è®¾æ–½éªŒè¯** - æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€
2. â³ **é¦–æ¬¡éƒ¨ç½²æµ‹è¯•** - éªŒè¯è‡ªåŠ¨åŒ–éƒ¨ç½²
3. â³ **åº”ç”¨åŠŸèƒ½æµ‹è¯•** - WordPress å®‰è£…å’ŒåŸºæœ¬åŠŸèƒ½
4. â³ **Session Affinity æµ‹è¯•** - ä¼šè¯ä¿æŒåŠŸèƒ½
5. â³ **å¥åº·æ£€æŸ¥æµ‹è¯•** - Probes æœºåˆ¶éªŒè¯
6. â³ **èµ„æºé™åˆ¶æµ‹è¯•** - Resources é…ç½®éªŒè¯
7. â³ **æŒä¹…åŒ–å­˜å‚¨æµ‹è¯•** - PVC æ•°æ®æŒä¹…åŒ–
8. â³ **æ‰©ç¼©å®¹æµ‹è¯•** - å‰¯æœ¬æ‰©ç¼©å®¹
9. â³ **etcd å¤‡ä»½æµ‹è¯•** - å¤‡ä»½åŠŸèƒ½éªŒè¯
10. âš ï¸ **ç¾éš¾æ¢å¤æ¼”ç»ƒ** - å¯é€‰ï¼Œé£é™©è¾ƒé«˜
11. â³ **æ¸…ç†é‡å»ºæµ‹è¯•** - éªŒè¯å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

---

## IaC åŸåˆ™è½åœ°æƒ…å†µ

| åŸåˆ™ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| é…ç½®å³ä»£ç  | âœ… | æ‰€æœ‰é…ç½®éƒ½æ˜¯ YAML æ–‡ä»¶ |
| ç‰ˆæœ¬æ§åˆ¶ | âœ… | å·²åˆ›å»º .gitignoreï¼Œå‡†å¤‡æäº¤ |
| è‡ªåŠ¨åŒ–éƒ¨ç½² | âœ… | deploy-all.sh è„šæœ¬ |
| å¹‚ç­‰æ€§ | âœ… | kubectl apply æ”¯æŒé‡å¤æ‰§è¡Œ |
| å¤‡ä»½ç­–ç•¥ | âœ… | etcd å¤‡ä»½è„šæœ¬ |
| ç¾éš¾æ¢å¤ | âœ… | etcd æ¢å¤è„šæœ¬ |
| æ–‡æ¡£åŒ– | âœ… | å®Œæ•´çš„æ–‡æ¡£å’Œæ³¨é‡Š |

---

## æŠ€æœ¯äº®ç‚¹

1. **å°æ­¥å¿«è·‘**: 11 ä¸ªç‹¬ç«‹æµ‹è¯•é˜¶æ®µï¼Œé€æ­¥éªŒè¯
2. **å®‰å…¨ç¬¬ä¸€**: å¤‡ä»½è„šæœ¬ã€åˆ é™¤ç¡®è®¤ã€æ•°æ®ä¿æŠ¤
3. **å®Œæ•´æ–‡æ¡£**: README + å¿«é€Ÿå‚è€ƒ + æµ‹è¯•è®¡åˆ’
4. **ç”Ÿäº§æ€ç»´**: å¥åº·æ£€æŸ¥ã€èµ„æºé™åˆ¶ã€ä¼šè¯ä¿æŒ
5. **æ˜“äºç»´æŠ¤**: æ¸…æ™°çš„ç›®å½•ç»“æ„ã€æ³¨é‡Šå®Œæ•´çš„è„šæœ¬

---

## ç»éªŒæ•™è®­åº”ç”¨

åŸºäº [kubekey-local/readme.md](../kubekey-local/readme.md) çš„æ•…éšœç»éªŒï¼š

- âœ… **IaC å®è·µ**: æ‰€æœ‰é…ç½®ç‰ˆæœ¬åŒ–ï¼Œä¸å†æ‰‹åŠ¨ kubectl apply
- âœ… **è‡ªåŠ¨åŒ–**: ä¸€é”®éƒ¨ç½²å’Œæ¸…ç†è„šæœ¬
- âœ… **etcd å¤‡ä»½**: å®šæœŸå¤‡ä»½è„šæœ¬ï¼Œé¿å…æ•°æ®ä¸¢å¤±
- âœ… **æ¢å¤æµç¨‹**: å®Œæ•´çš„ etcd æ¢å¤è„šæœ¬
- âœ… **æ¨¡å—åŒ–**: MySQL å’Œ WordPress é…ç½®åˆ†ç¦»

---

## å»ºè®®çš„æ‰§è¡Œé¡ºåº

**ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆæ¨èï¼‰**:

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/intel41/code/kube-202601/wordpress-k8s

# 2. é˜…è¯»æ–‡æ¡£
cat README.md
cat docs/test-plan.md

# 3. éªŒè¯é›†ç¾¤çŠ¶æ€
./scripts/verify.sh

# 4. å¤‡ä»½ etcdï¼ˆå®‰å…¨èµ·è§ï¼‰
./scripts/backup-etcd.sh

# 5. å¼€å§‹éƒ¨ç½²
./scripts/deploy-all.sh

# 6. æŒ‰æµ‹è¯•è®¡åˆ’é€æ­¥éªŒè¯
# å‚è€ƒ docs/test-plan.md æ‰§è¡Œæµ‹è¯•
```

---

**å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•ï¼** ğŸš€

å»ºè®®å…ˆæ‰§è¡Œ `./scripts/verify.sh` æ£€æŸ¥é›†ç¾¤çŠ¶æ€ã€‚
